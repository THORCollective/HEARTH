# H-2025-001

Threat actors may abuse netsh.exe or PowerShell to create, modify, or delete Windows Firewall rules or profiles in order to weaken host-based defenses, permit inbound or outbound communication for malicious tooling, or remove restrictions on command-and-control (C2) traffic. By excluding System integrity level processes, this hypothesis focuses on firewall changes initiated from user or elevated contexts, which are less common during normal operations and more indicative of defense evasion or persistence-related activity.

| Hunt #       | Idea / Hypothesis          | Tactic    | Notes                             | Tags      | Submitter |
|--------------|----------------------------|-----------|-----------------------------------|-----------|-----------|
|              | Threat actors may abuse netsh.exe or PowerShell to create, modify, or delete Windows Firewall rules or profiles in order to weaken host-based defenses, permit inbound or outbound communication for malicious tooling, or remove restrictions on command-and-control (C2) traffic. By excluding System integrity level processes, this hypothesis focuses on firewall changes initiated from user or elevated contexts, which are less common during normal operations and more indicative of defense evasion or persistence-related activity. | Tactic: Defense Evasion (TA0005) - Technique: Impair Defenses: Disable or Modify System Firewall (T1562.004)  | The hunt focuses on detecting firewall modifications initiated from user or elevated contexts, assuming these are less common during normal operations and more indicative of defense evasion or persistence-related activity. | #netsh #powershell #TA0005 #T1562.004 #firewall    | @tsof-smoky |

## Why
This hunt matters because attackers can temporarily weaken host-based firewall protections to enable command-and-control or payload delivery while leaving little to no persistent evidence. By detecting the act of firewall manipulation rather than the final rule state, defenders can identify stealthy defense-evasion techniques that traditional audits miss. Catching this behavior early helps prevent unauthorized network access, lateral movement, and data exfiltration, reducing overall breach impact.

## Implementation Notes
1. **Data requirements/source/log need**: Collect Windows Event Logs from Security (Event ID 4688 for process creation) and Microsoft-Windows-Windows Firewall With Advanced Security/Firewall (Event IDs 2003-2006 for rule changes). Additionally, gather Sysmon logs (Event ID 1 for process creation involving netsh.exe or PowerShell) and PowerShell script block logging (Event ID 4104). Endpoint detection and response (EDR) telemetry on command-line arguments and process integrity levels is essential.

2. **Hunting logic/assumptions**: Query for netsh.exe or PowerShell executions with command-line arguments related to firewall modifications (e.g., "netsh advfirewall firewall add/delete/set" or PowerShell cmdlets like New-NetFirewallRule), filtering out processes running at System integrity level. Assume user or elevated contexts indicate suspicious activity, correlating with firewall rule changes excluding benign administrative tasks. Focus on anomalies like unexpected inbound/outbound rules or profile alterations to flag potential defense evasion.

3. **Limitations**: This approach may miss obfuscated commands or alternative tools for firewall manipulation not involving netsh.exe or PowerShell. High false positives from legitimate admin activities in user contexts could occur without baselining. Excluding System processes might overlook sophisticated attacks elevating to System level, and incomplete logging configurations reduce detection efficacy.

## References
- https://attack.mitre.org/techniques/T1562/004/
- https://attack.mitre.org/tactics/TA0005/
- https://thedfirreport.com/2022/03/21/phosphorus-automates-initial-access-using-proxyshell/
- https://www.cisa.gov/news-events/cybersecurity-advisories/aa25-071a